<html>
<head>
	<!--<script src="../lib/json.js"></script>-->
	<script src="../lib/jquery.js"></script>
	<script src="../lib/underscore.js"></script>
	<script src="../lib/backbone.js"></script>
	<script src="../jsganttchart.js"></script>
	<link rel="stylesheet" href="style.css">
	<script>
		var gantt = JSGanttChart.create({
			resources: {
				programmer: "Peter West",
				supervisor: "mc",
				cosupervisor: "max"
			},
			types: {
				analysis: {
					name: "Analysis",
					color: "#C79810"  // yellow
				},
				critical: {
					name: "Critical",
					color: "#CC0000" // red
				},
				programming: {
					name: "Programming",
					color: "#356AA0" // blue
				},
				documentation: {
					name: "Documentation",
					color: "#FF7400" // orange
				}
			},
			elements: [
				{
					id: "meeting1",
					name: "Supervisor meeting",
					startDate: "1 October 2011 11:00",
					percentageDone: 100,
					resources: [ "programmer", "supervisor", "cosupervisor" ]
				},
				{
					id: "brief",
					name: "Project Brief",
					predecessors: ["meeting1"],
					startDate: "3 October 2011",
					endDate: "14 October 2011 16:00",
					type: "critical",
					slackDuration: 4, // or slackEndDate: date
					elements: [
						{
							predecessors: ["brief"],
							id: "prestudy2",
							name: "Prestudy",
							startDate: "18 October 2011",
							endDate: "29 October 2011",
							type: "analysis",
							percentageDone: 2,
						},
						{
							id: "reviewmeeting2",
							name: "Review meeting",
							startDate: "13 November 2011"
						},
					],
					percentageDone: 59,
					estimatedHours: 10
				},
				{
							predecessors: ["brief"],
					id: "prestudy",
					name: "Prestudy",
					startDate: "18 October 2011",
					endDate: "29 October 2011",
					type: "analysis",
					percentageDone: 2,
				},
				{
					id: "software1",
					name: "Software development P1",
					startDate: "20 October 2011",
					endDate: "14 December 2011"
				},
				{
					id: "study2",
					name: "Second study",
					startDate: "30 October 2011",
					endDate: "1 December 2011",
					type: "analysis"
				},
				{
					id: "reviewmeeting1",
					name: "Review meeting",
					startDate: "13 November 2011"
				},
				{
					id: "progreport",
					name: "Progress Report",
					startDate: "7 December 2011",
					endDate: "14 December 2011 16:00",
					type: "documentation"
				},
				{
					id: "finalreport",
					name: "Final Project Report",
					startDate: "2 April 2012",
					endDate: "2 May 2012",
					type: "documentation"
				}
			]
		});

		var currElementModel;

		function showEditForm (model) {
			var element = model.toJSON();
			jQuery("#editform").fadeIn();
			jQuery("#editform #f_id").val(element.id);
			jQuery("#editform #f_name").val(element.name);
			jQuery("#editform #f_start").val(element.startDate);
			jQuery("#editform #f_end").val(element.endDate);
			jQuery("#editform #f_slend").val(element.slackEndDate);
			jQuery("#editform #f_type").val(element.type);
			jQuery("#editform #f_done").val(element.percentageDone);
			jQuery("#editform #f_hours").val(element.hoursExpected);
			jQuery("#editform #f_resources").val(element.resources);
			currElementModel = model;
		}

		function showJSONEditForm () {
			jQuery("#jsonform").fadeIn();
			jQuery("#jsonform #f_json").val(JSON.stringify(gantt.getJSON()));
		}

		gantt.bind("row_click", function (e, model) {
			e.preventDefault();
			e.stopPropagation();
			showEditForm(model);
		});

		jQuery(window).ready(function () {
			jQuery("#container").append(gantt.render().el);

			jQuery("#editform #f_cancel").click(function () { jQuery("#editform").fadeOut(); });

			jQuery("#editform #f_submit, #editform #f_apply").click(function() {
				currElementModel.set({
					id: jQuery("#editform #f_id").val(),
					name: jQuery("#editform #f_name").val(),
					startDate: jQuery("#editform #f_start").val() ? 
							new Date(jQuery("#editform #f_start").val()) : undefined,
					endDate: jQuery("#editform #f_end").val() ? 
							new Date(jQuery("#editform #f_end").val()) : undefined,
					slackEndDate: jQuery("#editform #f_slend").val() ? 
							new Date(jQuery("#editform #f_slend").val()) : undefined,
					type: jQuery("#editform #f_type").val(),
					percentageDone: jQuery("#editform #f_done").val(),
					hoursExpected: jQuery("#editform #f_hours").val(),
					resources: jQuery("#editform #f_resources").val()
				});

			});

			jQuery("#editform #f_submit").click(function() {
				jQuery("#editform").fadeOut();
			});

			jQuery("#jsonform #f_cancel").click(function () { jQuery("#jsonform").fadeOut(); });

			jQuery("#jsonform #f_submit, #jsonform #f_apply").click(function() {
				gantt.setJSON(JSON.parse(jQuery("#jsonform #f_json").val()));
				
				jQuery("#editform").fadeOut();
			});

			jQuery("#jsonform #f_submit").click(function () { jQuery("#jsonform").fadeOut(); });

			jQuery("#add").click(function () {
				showEditForm(gantt.newElementModel());
			});

			jQuery("#json").click(function () {
				showJSONEditForm();
			});
		});
	</script>
</head>
<body>
	<div id="container"></div>
	<input type="button" id="add" value="Add">
	<input type="button" id="json" value="Edit JSON">
	<div id="editform">
		<div class="form">
			<table>
				<tr><th>ID:</th><td><input id="f_id" type="text" value=""></td></tr>
				<tr><th>Name:</th><td><input id="f_name" type="text" value=""></td></tr>
				<tr><th>Start Date:</th><td><input id="f_start" type="text" value=""></td></tr>
				<tr><th>End Date:</th><td><input id="f_end" type="text" value=""></td></tr>
				<tr><th>Slack End Date:</th><td><input id="f_slend" type="text" value=""></td></tr>
				<tr><th>Type:</th><td><input id="f_type" type="text" value=""></td></tr>
				<tr><th>Percentage Done:</th><td><input id="f_done" type="text" value=""></td></tr>
				<tr><th>Estimated Hours:</th><td><input id="f_hours" type="text" value=""></td></tr>
				<tr><th>Resources:</th><td><input id="f_resources" type="text" value=""></td></tr>
				<tr><th></th><td>
					<input id="f_apply" type="button" value="Apply">&nbsp;
					<input id="f_submit" type="submit" value="OK">&nbsp;
					<input id="f_cancel" type="button" value="Cancel">
				</td></tr>
			</table>
		</div>
	</div>
	<div id="jsonform">
		<div class="form">
			<textarea id="f_json"></textarea>
			<input id="f_apply" type="button" value="Apply">&nbsp;
			<input id="f_submit" type="submit" value="OK">&nbsp;
			<input id="f_cancel" type="button" value="Cancel">
		</div>
	</div>
</body>
</html>